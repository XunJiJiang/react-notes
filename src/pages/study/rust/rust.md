# rust

**å®‰è£…**

ç½‘ä¸ŠæŸ¥

**æ›´æ–°**

```shell
rustup update
```

## ç¼–è¯‘è¿è¡Œå•ä¸ªæ–‡ä»¶

main.rs

```rust
fn main() {
    println!("Hello world!");
}
```

```shell
# ç¼–è¯‘
rustc .\main.rs

# è¿è¡Œ
.\main.exe
```

`main`å‡½æ•°ä½œä¸ºå…¥å£å‡½æ•°ï¼Œæ²¡æœ‰å‚æ•°å’Œè¿”å›å€¼

å‡½æ•°ä½“è¢«åŒ…è£¹åœ¨ {} ä¸­ã€‚Rust è¦æ±‚æ‰€æœ‰å‡½æ•°ä½“éƒ½è¦ç”¨èŠ±æ‹¬å·åŒ…è£¹èµ·æ¥

å°†å·¦èŠ±æ‹¬å·ä¸å‡½æ•°å£°æ˜ç½®äºåŒä¸€è¡Œå¹¶ä»¥ç©ºæ ¼åˆ†éš”ï¼Œæ˜¯è‰¯å¥½çš„ä»£ç é£æ ¼

`println!`è°ƒç”¨äº†ä¸€ä¸ªRustå®(macro)ï¼Œå¦‚æœå¸Œæœ›è°ƒç”¨å‡½æ•°ï¼Œåˆ™æ²¡æœ‰`!`

å®ä¸å‡½æ•°æ˜¯ä¸¤ä¸ªé’™æ¦‚å¿µï¼Œå½“å‡ºç°`!`ç¬¦å·ï¼Œåˆ™æ˜¯åœ¨è°ƒç”¨å®è€Œä¸æ˜¯å‡½æ•°

åˆ†å·ä»£è¡¨ä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æŸï¼Œä¸‹ä¸€ä¸ªè¡¨è¾¾å¼çš„å¼€å§‹

## Cargo

Cargoæ˜¯rustçš„æ„å»ºç³»ç»Ÿå’ŒåŒ…(ä¾èµ–)ç®¡ç†å™¨

### ä½¿ç”¨Cargoåˆ›å»ºé¡¹ç›®

```shell
# æ–°å»ºäº†åä¸º hello_cargo çš„ç›®å½•å’Œé¡¹ç›®ï¼Œå¹¶ä¸”è‡ªåŠ¨åˆ›å»ºgitåˆå§‹åŒ–
cargo new hello_cargo
cd hello_cargo
```

```tree
hello_cargo
  | src
  | | main.rs
  | Cargo.toml
```

TOMLæ˜¯Cargoé…ç½®æ–‡ä»¶çš„æ ¼å¼
[package]ï¼šç‰‡æ®µæ ‡é¢˜
name: é¡¹ç›®å
versionï¼šé¡¹ç›®ç‰ˆæœ¬
editionï¼šrustç‰ˆæœ¬

[dependencies]ï¼šé¡¹ç›®ä¾èµ–ç‰‡æ®µçš„å¼€å§‹

Cargo æœŸæœ›æºæ–‡ä»¶å­˜æ”¾åœ¨ src ç›®å½•

æ ¹ç›®å½•åªå­˜æ”¾ READMEã€license ä¿¡æ¯ã€é…ç½®æ–‡ä»¶å’Œå…¶ä»–è·Ÿä»£ç æ— å…³çš„æ–‡ä»¶

**æ„å»ºé¡¹ç›®**

```rust
cargo build
```

è¿™ä¸ªå‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ target/debug/hello_cargo ï¼ˆåœ¨ Windows ä¸Šæ˜¯ target\debug\hello_cargo.exeï¼‰ï¼Œè€Œä¸æ˜¯æ”¾åœ¨ç›®å‰ç›®å½•ä¸‹

**æ„å»ºåŒæ—¶è¿è¡Œ**

```shell
# è¿™ä¸ªå‘½ä»¤å°†ä¼šåœ¨æ„å»ºåç›´æ¥è¿è¡Œ
cargo run
```

**æ£€æŸ¥ä»£ç æ˜¯å¦å¯ç¼–è¯‘**

```shell
# æ£€æŸ¥ä»£ç ä»¥ç¡®ä¿å…¶å¯ä»¥ç¼–è¯‘ï¼Œä¸äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶
# æ¯”buildå¿«å¾—å¤š
cargo chcek
```

**æ„å»ºå‘å¸ƒ(release)**

```shell
# ç”Ÿæˆä¼˜åŒ–ç¼–è¯‘é¡¹ç›®
cargo build --release
```

åœ¨ _target/release_ è€Œä¸æ˜¯ _target/debug_ ä¸‹ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶

## å¸¸è§ç¼–ç¨‹æ¦‚å¿µ

### å˜é‡å’Œå¯å˜æ€§

å˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„

```rust
let x = 5;
```

é€šè¿‡æ·»åŠ `mut`ä½¿å…¶å¯å˜ï¼Œä½†ç±»å‹ä¸å¯å˜

```rust
let mut x = 5;
```

#### å˜é‡è§£æ„

```rust
fn main() {
  let (a, mut b): (bool,bool) = (true, false);
  // a = true,ä¸å¯å˜; b = falseï¼Œå¯å˜
  println!("a = {:?}, b = {:?}", a, b);

  b = true;
  assert_eq!(a, b);
}
```

#### å¸¸é‡

ä¸å…è®¸å¯¹å¸¸é‡ä½¿ç”¨ `mut`

_å¿…é¡»_ æ³¨æ˜å€¼çš„ç±»å‹

```rust
const THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3;
```

Rust å¯¹å¸¸é‡çš„å‘½åçº¦å®šæ˜¯åœ¨å•è¯ä¹‹é—´ä½¿ç”¨å…¨å¤§å†™åŠ ä¸‹åˆ’çº¿

#### éšè—

å¯ä»¥å®šä¹‰ä¸€ä¸ªä¸ä¹‹å‰å˜é‡åŒåçš„æ–°å˜é‡ï¼Œç§°ä¹‹ä¸ºç¬¬ä¸€ä¸ªå˜é‡è¢«ç¬¬äºŒä¸ª **éšè—(Shadowing)**

```rust
fn main() {
  let x = 5; // å°† x ç»‘å®šåˆ°å€¼ 5 ä¸Š

  let x = x + 1; // é€šè¿‡ let x = åˆ›å»ºäº†ä¸€ä¸ªæ–°å˜é‡

  {
    // èŠ±æ‹¬å·åˆ›å»ºçš„å†…éƒ¨ä½œç”¨åŸŸå†…ï¼Œéšè—äº† x å¹¶åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å˜é‡
    let x = x * 2;
    println!("The value of x in the inner scope is: {x}");
  }

  println!("The value of x is: {x}");
}
```

å†æ¬¡ä½¿ç”¨ `let` æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸ä¹‹å‰çš„å€¼ä¸åŒçš„ç±»å‹

### æ•°æ®ç±»å‹

ä¸¤ç±»æ•°æ®ç±»å‹å­é›†ï¼šæ ‡é‡ï¼ˆscalarï¼‰å’Œå¤åˆï¼ˆcompoundï¼‰

#### æ ‡é‡ç±»å‹

**æ ‡é‡**ï¼ˆ_scalar_ï¼‰ç±»å‹ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„å€¼

å››ç§åŸºæœ¬çš„æ ‡é‡ç±»å‹ï¼šæ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”ç±»å‹ã€å­—ç¬¦ç±»å‹

##### æ•´å‹

æ•´å‹æ˜¯ä¸€ä¸ªæ²¡æœ‰å°æ•°éƒ¨åˆ†çš„æ•°å­—

| é•¿åº¦    | æœ‰ç¬¦å·  | æ— ç¬¦å·  |
| ------- | ------- | ------- |
| 8-bit   | `i8`    | `u8`    |
| 16-bit  | `i16`   | `u16`   |
| 32-bit  | `i32`   | `u32`   |
| 64-bit  | `i64`   | `u64`   |
| 128-bit | `i128`  | `u128`  |
| arch    | `isize` | `usize` |

`isize` å’Œ `usize` ç±»å‹ä¾èµ–è¿è¡Œç¨‹åºçš„è®¡ç®—æœºæ¶æ„ï¼š64 ä½æ¶æ„ä¸Šå®ƒä»¬æ˜¯ 64 ä½çš„ï¼Œ32 ä½æ¶æ„ä¸Šå®ƒä»¬æ˜¯ 32 ä½çš„ã€‚

å¯ä»¥æ˜¯å¤šç§æ•°å­—ç±»å‹çš„æ•°å­—å­—é¢å€¼å…è®¸ä½¿ç”¨ç±»å‹åç¼€

`57u8` è¡¨ç¤ºå€¼ä¸º`57`ï¼Œç±»å‹ä¸º`u8`

å…è®¸ä½¿ç”¨ `_` åšä¸ºåˆ†éš”ç¬¦ä»¥æ–¹ä¾¿è¯»æ•°

`1_000` è¡¨ç¤º`1000`

`0b1111_0000`è¡¨ç¤º`0b11110000`

| æ•°å­—å­—é¢å€¼                    | ä¾‹å­          |
| ----------------------------- | ------------- |
| Decimal (åè¿›åˆ¶)              | `98_222`      |
| Hex (åå…­è¿›åˆ¶)                | `0xff`        |
| Octal (å…«è¿›åˆ¶)                | `0o77`        |
| Binary (äºŒè¿›åˆ¶)               | `0b1111_0000` |
| Byte (å•å­—èŠ‚å­—ç¬¦)(ä»…é™äº`u8`) | `b'A'`        |

æ•°å­—ç±»å‹é»˜è®¤æ˜¯ `i32`

> ##### æ•´å‹æº¢å‡º
>
> æ¯”å¦‚æœ‰ä¸€ä¸ª `u8`ï¼Œå¯ä»¥å­˜æ”¾ä»é›¶åˆ° `255` çš„å€¼
>
> å½“å°†å…¶ä¿®æ”¹ä¸º `256` æ—¶ï¼Œä¼šå¯¼è‡´ä»¥ä¸‹ä¸¤ç§è¡Œä¸ºä¹‹ä¸€çš„å‘ç”Ÿ
>
> å½“åœ¨ debug æ¨¡å¼ç¼–è¯‘æ—¶ï¼ŒRust æ£€æŸ¥è¿™ç±»é—®é¢˜å¹¶ä½¿ç¨‹åº _panic_(panicè¢«Rust ç”¨æ¥è¡¨æ˜ç¨‹åºå› é”™è¯¯è€Œé€€å‡º)
>
> åœ¨ release æ¨¡å¼ä¸­æ„å»ºæ—¶ï¼Œ**ä¸ä¼š**æ£€æµ‹ä¼šå¯¼è‡´ panic çš„æ•´å‹æº¢å‡ºï¼Œè€Œä¼šè¿›è¡Œä¸€ç§è¢«ç§°ä¸ºäºŒè¿›åˆ¶è¡¥ç  wrappingï¼ˆ_twoâ€™s complement wrapping_ï¼‰çš„æ“ä½œï¼Œ`256` å˜æˆ `0`ï¼Œå€¼ `257` å˜æˆ `1`

##### æµ®ç‚¹å‹

Rust çš„æµ®ç‚¹æ•°ç±»å‹æ˜¯ `f32` å’Œ `f64`ï¼Œé»˜è®¤ç±»å‹æ˜¯ `f64`

```rust
fn main() {
  let x = 2.0; // f64
  let y: f32 = 3.0; // f32
}
```

æµ®ç‚¹æ•°é‡‡ç”¨ IEEE-754 æ ‡å‡†è¡¨ç¤º

##### æ•°å€¼è¿ç®—

```rust
fn main() {
    // addition
    let sum = 5 + 10;

    // subtraction
    let difference = 95.5 - 4.3;

    // multiplication
    let product = 4 * 30;

    // division
    let quotient = 56.7 / 32.2;
    let truncated = -5 / 3; // ç»“æœä¸º -1

    // remainder
    let remainder = 43 % 5;
}
```

ä¸åŒç±»å‹ä¹‹é—´ä¸èƒ½è¿ç®—

##### å¸ƒå°”å‹

å¸ƒå°”ç±»å‹ä½¿ç”¨ `bool` è¡¨ç¤º

##### å­—ç¬¦ç±»å‹

Rust çš„ `char` ç±»å‹æ˜¯è¯­è¨€ä¸­æœ€åŸç”Ÿçš„å­—æ¯ç±»å‹

ç”¨å•å¼•å·å£°æ˜ `char` å­—é¢é‡ï¼Œç”¨åŒå¼•å·å£°æ˜`å­—ç¬¦ä¸²`å­—é¢é‡

```rust
fn main() {
    let c = 'z';
    let z: char = 'â„¤'; // with explicit type annotation
    let heart_eyed_cat = 'ğŸ˜»';
}
```

Rust çš„ `char` ç±»å‹çš„å¤§å°ä¸ºå››ä¸ªå­—èŠ‚ï¼Œå¹¶ä»£è¡¨äº†ä¸€ä¸ª Unicode æ ‡é‡å€¼

Rust ä¸­ï¼Œå¸¦å˜éŸ³ç¬¦å·çš„å­—æ¯ï¼Œä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ç­‰å­—ç¬¦ï¼Œemojiã€é›¶é•¿åº¦çš„ç©ºç™½å­—ç¬¦éƒ½æ˜¯æœ‰æ•ˆçš„ `char` å€¼

#### å¤åˆç±»å‹

Rust æœ‰ä¸¤ä¸ªåŸç”Ÿçš„å¤åˆç±»å‹ï¼šå…ƒç»„ï¼ˆtupleï¼‰å’Œæ•°ç»„ï¼ˆarrayï¼‰

##### å…ƒç»„ç±»å‹

å…ƒç»„æ˜¯å°†å¤šä¸ªå…¶ä»–ç±»å‹çš„å€¼ç»„åˆè¿›ä¸€ä¸ªå¤åˆç±»å‹çš„ä¸»è¦æ–¹å¼

å…ƒç»„é•¿åº¦å›ºå®šï¼šä¸€æ—¦å£°æ˜ï¼Œå…¶é•¿åº¦ä¸ä¼šå¢å¤§æˆ–ç¼©å°

ä½¿ç”¨åŒ…å«åœ¨åœ†æ‹¬å·ä¸­çš„é€—å·åˆ†éš”çš„å€¼åˆ—è¡¨æ¥åˆ›å»ºä¸€ä¸ªå…ƒç»„ï¼Œæ¯ä¸€ä¸ªä½ç½®éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼Œè¿™äº›ä¸åŒå€¼çš„ç±»å‹ä¹Ÿä¸å¿…æ˜¯ç›¸åŒçš„

**è®¿é—®å…ƒç´ **

ä¸ºäº†ä»å…ƒç»„ä¸­è·å–å•ä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…ï¼ˆpattern matchingï¼‰æ¥è§£æ„ï¼ˆdestructureï¼‰å…ƒç»„å€¼

ä¹Ÿå¯ä»¥ä½¿ç”¨ç‚¹å·ï¼ˆ`.`ï¼‰åè·Ÿå€¼çš„ç´¢å¼•æ¥ç›´æ¥è®¿é—®å®ƒä»¬ï¼ˆç¬¬ä¸€ä¸ªç´¢å¼•å€¼æ˜¯ 0ï¼‰

```rust
fn main() {
  let tup: (i32, f64, u8) = (500, 6.4, 1);
  let (x, y, z) = tup; // è§£æ„

  let x: (i32, f64, u8) = (500, 6.4, 1);
  let five_hundred = x.0; // ç´¢å¼•
  let six_point_four = x.1;
  let one = x.2;
}
```

ä¸å¸¦ä»»ä½•å€¼çš„å…ƒç»„ï¼Œå«åš **å•å…ƒï¼ˆunitï¼‰** å…ƒç»„

è¿™ç§å€¼ä»¥åŠå¯¹åº”çš„ç±»å‹éƒ½å†™ä½œ `()`ï¼Œè¡¨ç¤ºç©ºå€¼æˆ–ç©ºçš„è¿”å›ç±»å‹

å¦‚æœè¡¨è¾¾å¼ä¸è¿”å›ä»»ä½•å…¶ä»–å€¼ï¼Œåˆ™ä¼šéšå¼è¿”å›å•å…ƒå€¼ã€‚

##### æ•°ç»„ç±»å‹

ä¸å…ƒç»„ä¸åŒï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒ

Rust ä¸­çš„æ•°ç»„é•¿åº¦æ˜¯å›ºå®šçš„

æ•°ç»„å¹¶ä¸å¦‚ vector ç±»å‹çµæ´»ã€‚vector ç±»å‹æ˜¯æ ‡å‡†åº“æä¾›çš„ä¸€ä¸ª **å…è®¸** å¢é•¿å’Œç¼©å°é•¿åº¦çš„ç±»ä¼¼æ•°ç»„çš„é›†åˆç±»å‹

å¯ä»¥åƒè¿™æ ·ç¼–å†™æ•°ç»„çš„ç±»å‹ï¼šåœ¨æ–¹æ‹¬å·ä¸­åŒ…å«æ¯ä¸ªå…ƒç´ çš„ç±»å‹ï¼Œåè·Ÿåˆ†å·ï¼Œå†åè·Ÿæ•°ç»„å…ƒç´ çš„æ•°é‡ã€‚

```rust
let a: [i32; 5] = [1, 2, 3, 4, 5]; // [ç±»å‹; æ•°é‡]
```

è¿˜å¯ä»¥é€šè¿‡åœ¨æ–¹æ‹¬å·ä¸­æŒ‡å®šåˆå§‹å€¼ï¼ŒåŠ åˆ†å·ï¼Œå†åŠ å…ƒç´ ä¸ªæ•°çš„æ–¹å¼æ¥åˆ›å»ºä¸€ä¸ªæ¯ä¸ªå…ƒç´ éƒ½ä¸ºç›¸åŒå€¼çš„æ•°ç»„

```rust
let a = [3; 5]; // let a = [3, 3, 3, 3, 3];
```

**è®¿é—®å…ƒç´ **

ä½¿ç”¨ç´¢å¼•æ¥è®¿é—®æ•°ç»„çš„å…ƒç´ 

```rust
fn main() {
    let a = [1, 2, 3, 4, 5];
    let first = a[0];
    let second = a[1];
}
```

> å¦‚æœè®¿é—®æ•°ç»„ç»“å°¾ä¹‹åçš„å…ƒç´ ï¼Œæ¯”å¦‚æ¥å—ç”¨æˆ·è¾“å…¥çš„æ•°å€¼6ä½œä¸ºé•¿åº¦5çš„æ•°ç»„çš„ä¸‹æ ‡
>
> å°†ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯

### å‡½æ•°

`main` å‡½æ•°æ˜¯å¾ˆå¤šç¨‹åºçš„å…¥å£ç‚¹

`fn` å…³é”®å­—ç”¨æ¥å£°æ˜æ–°å‡½æ•°

Rust ä»£ç ä¸­çš„å‡½æ•°å’Œå˜é‡åä½¿ç”¨ _snake case_ è§„èŒƒé£æ ¼ï¼Œæ‰€æœ‰å­—æ¯éƒ½æ˜¯å°å†™å¹¶ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯

```rust
another_function();
```

Rust ä¸å…³å¿ƒå‡½æ•°å®šä¹‰æ‰€åœ¨çš„ä½ç½®ï¼Œåªè¦å‡½æ•°è¢«è°ƒç”¨æ—¶å‡ºç°åœ¨è°ƒç”¨ä¹‹å¤„å¯è§çš„ä½œç”¨åŸŸå†…å°±è¡Œã€‚

#### å‚æ•°

åœ¨å‡½æ•°ç­¾åä¸­ï¼Œ**å¿…é¡»** å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹

```rust
fn another_function(x: i32) {
    println!("The value of x is: {x}");
}
```

#### è¯­å¥å’Œè¡¨è¾¾å¼

**è¯­å¥**ï¼ˆ_Statements_ï¼‰æ˜¯æ‰§è¡Œä¸€äº›æ“ä½œä½†ä¸è¿”å›å€¼çš„æŒ‡ä»¤ã€‚ **è¡¨è¾¾å¼**ï¼ˆ_Expressions_ï¼‰è®¡ç®—å¹¶äº§ç”Ÿä¸€ä¸ªå€¼ã€‚

`let y = 6;` æ˜¯ä¸€ä¸ªè¯­å¥

`5 + 6`æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼

å‡½æ•°è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç”¨å¤§æ‹¬å·åˆ›å»ºçš„ä¸€ä¸ªæ–°çš„å—ä½œç”¨åŸŸä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼

ä¸‹é¢è¿™ä¸ªä½œç”¨äºå—å°†`x + 1`ä½œä¸ºè¡¨è¾¾å¼è¿”å›çš„å€¼ï¼Œæ³¨æ„ `x+1` è¿™ä¸€è¡Œåœ¨ç»“å°¾æ²¡æœ‰åˆ†å·

å¦‚æœåœ¨è¡¨è¾¾å¼çš„ç»“å°¾åŠ ä¸Šåˆ†å·ï¼Œå®ƒå°±å˜æˆäº†è¯­å¥ï¼Œè€Œè¯­å¥ä¸ä¼šè¿”å›å€¼

```rust
fn main() {
  let y = {
    let x = 3;
    println!("in Y");
    x + 1
  };
  println!("after Y");
  println!("The value of y is: 4{y}"); // The value of y is: 4
}
// è¾“å‡º
// in Y
// after Y
// The value of y is: 4
```

#### å…·æœ‰è¿”å›å€¼çš„å‡½æ•°

åœ¨ç®­å¤´ï¼ˆ`->`ï¼‰åå£°æ˜è¿”å›å€¼çš„ç±»å‹

```rust
fn five() -> i32 {
  5
}
```

> Rust ä¸­ä¹Ÿæœ‰ return å…³é”®å­—
>
> ```rust
> fn five() -> i32 {
> return 5;
> }
> ```
>
> Rust æ›´é¼“åŠ±ä¸ä½¿ç”¨returnå…³é”®å­—ï¼Œå®ƒæ›´åŠ ç®€æ´å’Œç¬¦åˆ Rust çš„é£æ ¼

### æ³¨é‡Š

```rust
// æ³¨é‡Š
```

### æ§åˆ¶æµ

Rust ä»£ç ä¸­æœ€å¸¸è§çš„ç”¨æ¥æ§åˆ¶æ‰§è¡Œæµçš„ç»“æ„æ˜¯ `if` è¡¨è¾¾å¼å’Œå¾ªç¯ã€‚

#### ifè¡¨è¾¾å¼

```rust
let number = 3;

if number < 5 {
  println!("condition was true");
} else {
  println!("condition was false");
}
```

> <warn/>
>
> Rust å¹¶ä¸ä¼šå°è¯•è‡ªåŠ¨åœ°å°†éå¸ƒå°”å€¼è½¬æ¢ä¸ºå¸ƒå°”å€¼
>
> ä»£ç ä¸­çš„æ¡ä»¶ **å¿…é¡»** æ˜¯ `bool` å€¼ï¼Œå¦åˆ™æ— æ³•é€šè¿‡ç¼–è¯‘

```rust
let number = if true { 5 } else { 6 };
```

`if` æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨ `let` è¯­å¥çš„å³ä¾§ä½¿ç”¨å®ƒï¼Œ

> <warn/>
>
> `if` çš„æ¯ä¸ªåˆ†æ”¯çš„å¯èƒ½çš„è¿”å›å€¼éƒ½å¿…é¡»æ˜¯ç›¸åŒç±»å‹
>
> å¦‚æœå®ƒä»¬çš„ç±»å‹ä¸åŒ¹é…ï¼Œå¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œåˆ™ä¼šå‡ºç°ä¸€ä¸ªé”™è¯¯ï¼š
>
> ```rust
> fn main() {
> let number = if true { 5 } else { "six" };
> println!("The value of number is: {number}");
> }
> ```

#### å¾ªç¯

Rust æœ‰ä¸‰ç§å¾ªç¯ï¼š`loop`ã€`while` å’Œ `for`

##### loopæ— æ¡ä»¶å¾ªç¯

`loop` å…³é”®å­—å‘Šè¯‰ Rust ä¸€éåˆä¸€éåœ°æ‰§è¡Œä¸€æ®µä»£ç ç›´åˆ°æ˜ç¡®è¦æ±‚åœæ­¢ã€‚

å¯ä»¥ä½¿ç”¨ `break` å…³é”®å­—æ¥å‘Šè¯‰ç¨‹åºä½•æ—¶åœæ­¢å¾ªç¯ã€‚

`continue` å…³é”®å­—å‘Šè¯‰ç¨‹åºè·³è¿‡è¿™ä¸ªå¾ªç¯è¿­ä»£ä¸­çš„ä»»ä½•å‰©ä½™ä»£ç ï¼Œå¹¶è½¬åˆ°ä¸‹ä¸€ä¸ªè¿­ä»£ã€‚

**ä»å¾ªç¯è¿”å›å€¼**

```rust
fn main() {
  let mut counter = 0;

  let result = loop {
    counter += 1;

    if counter == 10 {
      break counter * 2;
    }
  };

  println!("The result is {result}");
}
```

**å¾ªç¯æ ‡ç­¾**

```rust
fn main() {
  let mut count = 0;
  'counting_up: loop {
    println!("count = {count}");
    let mut remaining = 10;

    loop {
      println!("remaining = {remaining}");
      if remaining == 9 {
        break;
      }
      if count == 2 {
        break 'counting_up;
      }
      remaining -= 1;
    }

    count += 1;
  }
  println!("End count = {count}");
}
```

##### whileæ¡ä»¶å¾ªç¯

```rust
fn main() {
  let mut number = 3;

  while number != 0 {
    println!("{number}!");

    number -= 1;
  }

  println!("LIFTOFF!!!");
}
```

##### for

```rust
fn main() {
  let a = [10, 20, 30, 40, 50];

  for element in a {
    println!("the value is: {element}");
  }
}
```

## æ‰€æœ‰æƒ

### æ‰€æœ‰æƒ(ç§»åŠ¨)

> **æ‰€æœ‰æƒè§„åˆ™**
>
> 1. Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ª **æ‰€æœ‰è€…**ï¼ˆ_owner_ï¼‰ã€‚
> 2. å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚
> 3. å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒã€‚

**`String` ç±»å‹**

æ­¤å¤„ä¸“æ³¨äº `String` ä¸æ‰€æœ‰æƒç›¸å…³çš„éƒ¨åˆ†ã€‚è¿™äº›æ–¹é¢ä¹ŸåŒæ ·é€‚ç”¨äºæ ‡å‡†åº“æä¾›çš„æˆ–ä½ è‡ªå·±åˆ›å»ºçš„å…¶ä»–å¤æ‚æ•°æ®ç±»å‹

```rust
let mut s = String::from("hello");
s.push_str(", world!"); // push_str() åœ¨å­—ç¬¦ä¸²åè¿½åŠ å­—é¢å€¼
println!("{}", s); // å°†æ‰“å° `hello, world!`
```

**å†…å­˜ä¸åˆ†é…**

1. å¿…é¡»åœ¨è¿è¡Œæ—¶å‘å†…å­˜åˆ†é…å™¨ï¼ˆmemory allocatorï¼‰è¯·æ±‚å†…å­˜ã€‚
2. éœ€è¦ä¸€ä¸ªå½“æˆ‘ä»¬å¤„ç†å®Œ `String` æ—¶å°†å†…å­˜è¿”å›ç»™åˆ†é…å™¨çš„æ–¹æ³•ã€‚

å¯¹äºç¬¬äºŒæ­¥ï¼ŒRust é‡‡å–çš„ç­–ç•¥ä¸ºï¼šå†…å­˜åœ¨æ‹¥æœ‰å®ƒçš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸåå°±è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚

å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸï¼ŒRust ä¸ºæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å«åš [`drop`](https://doc.rust-lang.org/std/ops/trait.Drop.html#tymethod.drop)ï¼Œåœ¨è¿™é‡Œ `String` çš„ä½œè€…å¯ä»¥æ”¾ç½®é‡Šæ”¾å†…å­˜çš„ä»£ç ã€‚Rust åœ¨ç»“å°¾çš„ `}` å¤„è‡ªåŠ¨è°ƒç”¨ `drop`ã€‚

**ç§»åŠ¨**

```rust
let s1 = String::from("hello");
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒStringç”³è¯·äº†ä¸€å—å†…å­˜ç”¨äºæ”¾ç½®å­—ç¬¦ä¸²å†…å®¹ï¼Œè¿”å›Stringç±»å‹çš„æ•°æ®å­˜æ”¾åœ¨`s1`

`String` ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªæŒ‡å‘å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹å†…å­˜çš„æŒ‡é’ˆï¼Œä¸€ä¸ªé•¿åº¦ï¼Œå’Œä¸€ä¸ªå®¹é‡ã€‚

```rust
let s2 = s1;
```

å˜é‡`s2`æ‹¥æœ‰ä¸€ä»½`s1` æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡çš„æ‹·è´ï¼Œ`s2`çš„æŒ‡é’ˆæŒ‡å‘äº†ä¸`s1`çš„æŒ‡é’ˆç›¸åŒçš„å†…å­˜åŒºåŸŸ

æ­¤æ—¶ï¼Œå¦‚æœä¸åšä»»ä½•æ“ä½œï¼Œ`s1`å’Œ`s2`åœ¨ç¦»å¼€ä½œç”¨åŸŸåï¼Œå®ƒä»¬éƒ½ä¼šå°è¯•é‡Šæ”¾ç›¸åŒçš„å†…å­˜ã€‚è¿™æ˜¯ä¸€ä¸ªå«åš **äºŒæ¬¡é‡Šæ”¾**ï¼ˆ_double free_ï¼‰çš„é”™è¯¯ã€‚ä¸¤æ¬¡é‡Šæ”¾ï¼ˆç›¸åŒï¼‰å†…å­˜ä¼šå¯¼è‡´å†…å­˜æ±¡æŸ“ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚

ä¸ºäº†ç¡®ä¿å†…å­˜å®‰å…¨ï¼Œåœ¨ `let s2 = s1;` ä¹‹åï¼ŒRust è®¤ä¸º `s1` ä¸å†æœ‰æ•ˆï¼Œ`s1`å°±æˆä¸ºä¸€ä¸ªæ— æ•ˆå¼•ç”¨ã€‚

æ‹·è´æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡è€Œä¸æ‹·è´æ•°æ®å¯èƒ½å¬èµ·æ¥åƒæµ…æ‹·è´ï¼Œä¸è¿‡å› ä¸º Rust åŒæ—¶ä½¿ç¬¬ä¸€ä¸ªå˜é‡æ— æ•ˆäº†ï¼Œè¿™ä¸ªæ“ä½œè¢«ç§°ä¸º **ç§»åŠ¨**ï¼ˆ_move_ï¼‰ï¼Œè€Œä¸æ˜¯å«åšæµ…æ‹·è´ã€‚

**å…‹éš†**

å¦‚æœç¡®å®éœ€è¦æ·±åº¦å¤åˆ¶ `String` ä¸­å †ä¸Šçš„æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯æ ˆä¸Šçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åš `clone` çš„é€šç”¨å‡½æ•°ã€‚

```rust
let s1 = String::from("hello");
let s2 = s1.clone();
println!("s1 = {s1}, s2 = {s2}");
```

**æ‹·è´**

```rust
let x = 5;
let y = x;
println!("x = {x}, y = {y}");
```

åƒæ•´å‹è¿™æ ·çš„**åœ¨ç¼–è¯‘æ—¶å·²çŸ¥å¤§å°**çš„ç±»å‹è¢«æ•´ä¸ª**å­˜å‚¨åœ¨æ ˆ**ä¸Šï¼Œæ²¡æœ‰ç†ç”±åœ¨åˆ›å»ºå˜é‡ `y` åä½¿ `x` æ— æ•ˆã€‚

ä¸Šè¿°æ“ä½œå¯¹å‡½æ•°åŒæ ·æœ‰æ•ˆ

```rust
fn main() {
  let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ

  takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...
                                  // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ

  let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ

  makes_copy(x);                  // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ
                                  // ä½† i32 æ˜¯ Copy çš„ï¼Œ
                                  // æ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x

} // è¿™é‡Œï¼Œx å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ
  // æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„

fn takes_ownership(some_string: String) { // some_string è¿›å…¥ä½œç”¨åŸŸ
  println!("{}", some_string);
} // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚
  // å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾

fn makes_copy(some_integer: i32) { // some_integer è¿›å…¥ä½œç”¨åŸŸ
  println!("{}", some_integer);
} // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„
```

è¿”å›å€¼ä¹Ÿå¯ä»¥è½¬ç§»æ‰€æœ‰æƒ

### å¼•ç”¨ä¸å€Ÿç”¨

**å¼•ç”¨**ï¼ˆ_reference_ï¼‰åƒä¸€ä¸ªæŒ‡é’ˆï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåœ°å€ï¼Œå¯ä»¥ç”±æ­¤è®¿é—®å‚¨å­˜äºè¯¥åœ°å€çš„å±äºå…¶ä»–å˜é‡çš„æ•°æ®ã€‚ ä¸æŒ‡é’ˆä¸åŒï¼Œå¼•ç”¨ç¡®ä¿æŒ‡å‘æŸä¸ªç‰¹å®šç±»å‹çš„æœ‰æ•ˆå€¼ã€‚

```rust
let s1 = String::from("hello");
let len = calculate_length(&s1);
fn calculate_length(s: &String) -> usize { // s æ˜¯ String çš„å¼•ç”¨
  s.len()
}
```

`&s1` è¯­æ³•åˆ›å»ºä¸€ä¸ª **æŒ‡å‘** å€¼ `s1` çš„å¼•ç”¨

`s`æŒ‡å‘`s1` çš„åœ°å€ï¼Œ`s1`æŒ‡å‘å€¼çš„åœ°å€

é€šè¿‡`s`å¯ä»¥ç›´æ¥è®¿é—®`s1`çš„å€¼ï¼Œè€Œä½œç”¨åŸŸç»“æŸæ—¶ä¸ä¼šä¸¢å¼ƒ`s1`æŒ‡å‘å€¼çš„å†…å®¹

> å¤§æ¦‚æ˜¯å› ä¸º`s`æ‹¥æœ‰çš„å†…å®¹æ˜¯`s1`çš„åœ°å€è€Œä¸æ˜¯`s1`æŒ‡å‘çš„å€¼ï¼Œè€Œåœ°å€æ˜¯å¯Copyçš„ï¼Œå› æ­¤`calculate_length`ç»“æŸåä¸éœ€è¦è¿›è¡Œä»»ä½•æ¸…ç†

å°†åˆ›å»ºä¸€ä¸ªå¼•ç”¨çš„è¡Œä¸ºç§°ä¸º **å€Ÿç”¨**ï¼ˆ_borrowing_ï¼‰

æ­£å¦‚å˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„ï¼Œå¼•ç”¨ä¹Ÿä¸€æ ·ã€‚ï¼ˆé»˜è®¤ï¼‰ä¸å…è®¸ä¿®æ”¹å¼•ç”¨çš„å€¼ã€‚

```rust
fn main() {
  let s = String::from("hello");

  change(&s);
}

fn change(some_string: &String) {
  some_string.push_str(", world"); // é”™è¯¯
}
```

**å¯å˜å¼•ç”¨**

é€šè¿‡ä¸€ä¸ªå°è°ƒæ•´å°±èƒ½ä¿®å¤ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­çš„é”™è¯¯ï¼Œå…è®¸ä¿®æ”¹ä¸€ä¸ªå€Ÿç”¨çš„å€¼ï¼Œè¿™å°±æ˜¯ **å¯å˜å¼•ç”¨**ï¼ˆ_mutable reference_ï¼‰

```rust
fn main() {
  // å°† s æ”¹ä¸º mut
  let mut s = String::from("hello");
  // åˆ›å»ºä¸€ä¸ªå¯å˜å¼•ç”¨ &mut s
  change(&mut s);
}
// æ›´æ–°å‡½æ•°ç­¾å
fn change(some_string: &mut String) {
  some_string.push_str(", world");
}
```

å¿…é¡»å°† `s` æ”¹ä¸º `mut`ï¼Œç„¶ååœ¨è°ƒç”¨ `change` å‡½æ•°çš„åœ°æ–¹åˆ›å»ºä¸€ä¸ªå¯å˜å¼•ç”¨ `&mut s`ï¼Œå¹¶æ›´æ–°å‡½æ•°ç­¾åä»¥æ¥å—ä¸€ä¸ªå¯å˜å¼•ç”¨ `some_string: &mut String`ã€‚

ä¸èƒ½åœ¨ç¬¬ä¸€ä¸ªå¯å˜å¼•ç”¨çš„**åˆ›å»ºå’Œä½¿ç”¨ä¹‹é—´**åˆ›å»ºç¬¬äºŒä¸ªå¯å˜å¼•ç”¨ï¼Œä¹Ÿä¸èƒ½åœ¨æ‹¥æœ‰ä¸å¯å˜å¼•ç”¨çš„åŒæ—¶æ‹¥æœ‰å¯å˜å¼•ç”¨ã€‚(å¯ä»¥åŒæ—¶æ‹¥æœ‰å¤šä¸ªä¸å¯å˜å¼•ç”¨)

```rust
let mut s = String::from("hello");

let r1 = &mut s;
let r2 = &mut s;  // cannot borrow 's' as mutable more than once at a time  second mutable borrow occurs here
println!("{}, {}", r1, r2);
let r2 = &mut s; // å¯ä»¥
```

å½“ç¡®ä¿å‰é¢çš„å¯å˜å¼•ç”¨ä¸ä¼šå†ä½¿ç”¨åï¼Œæ‰å¯ä»¥å¯¹åŒä¸€ä¸ªå¯å˜å˜é‡åˆ›å»ºå¦ä¸€ä¸ªå¯å˜å¼•ç”¨

è¿™å°†ä¼šä¿è¯ä¸ä¼šæœ‰ä¸¤ä¸ªæˆ–æ›´å¤šæŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€æ•°æ®

### Sliceç±»å‹

_slice_ å…è®¸å¼•ç”¨é›†åˆä¸­ä¸€æ®µè¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸ç”¨å¼•ç”¨æ•´ä¸ªé›†åˆã€‚slice æ˜¯ä¸€ç§å¼•ç”¨ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰æ‰€æœ‰æƒã€‚

```rust
let s = String::from("hello world"); // å€¼é•¿åº¦11ï¼Œä¸‹æ ‡0~10

let hello = &s[0..5];  // ä»sçš„ä¸‹æ ‡0ä½ç½®å¼€å§‹å¼•ç”¨ï¼Œç›´åˆ°ä¸‹æ ‡ä¸º5ã€‚ä¸åŒ…æ‹¬5
let world = &s[6..11]; // ä»sçš„ä¸‹æ ‡6ä½ç½®å¼€å§‹å¼•ç”¨ï¼Œç›´åˆ°ä¸‹æ ‡ä¸º11ã€‚ä¸åŒ…æ‹¬11
```

å¯¹äº Rust çš„ `..` range è¯­æ³•ï¼Œå¦‚æœæƒ³è¦ä»ç´¢å¼• 0 å¼€å§‹ï¼Œå¯ä»¥ä¸å†™ä¸¤ä¸ªç‚¹å·ä¹‹å‰çš„å€¼ã€‚`&s[..5]`

å¦‚æœ slice åŒ…å« `String` çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿå¯ä»¥èˆå¼ƒå°¾éƒ¨çš„æ•°å­—ã€‚`&s[6..]`

> å­—ç¬¦ä¸² slice range çš„ç´¢å¼•å¿…é¡»ä½äºæœ‰æ•ˆçš„ UTF-8 å­—ç¬¦è¾¹ç•Œå†…ï¼Œå¦‚æœå°è¯•ä»ä¸€ä¸ªå¤šå­—èŠ‚å­—ç¬¦çš„ä¸­é—´ä½ç½®åˆ›å»ºå­—ç¬¦ä¸² sliceï¼Œåˆ™ç¨‹åºå°†ä¼šå› é”™è¯¯è€Œé€€å‡ºã€‚

> ç±»å‹`&str` æ˜¯ä¸€ä¸ªä¸å¯å˜å¼•ç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘äºŒè¿›åˆ¶ç¨‹åºç‰¹å®šä½ç½®çš„ slice
>
> ```rust
> let s = "Hello, world!";
> ```

**å…¶ä»–ç±»å‹çš„ slice**

é™¤äº†é’ˆå¯¹å­—ç¬¦ä¸²çš„ `slice`ï¼Œä¹Ÿæœ‰æ›´é€šç”¨çš„ slice ç±»å‹ã€‚

```rust
let a = [1, 2, 3, 4, 5];

let slice = &a[1..3];

assert_eq!(slice, &[2, 3]); // assert_eqï¼æ–­è¨€ä¸¤ä¸ªå‚æ•°æ˜¯å¦ç›¸ç­‰
```

## ä½¿ç”¨ç»“æ„ä½“ç»„ç»‡ç›¸å…³è”çš„æ•°æ®

### ç»“æ„ä½“å®šä¹‰å’Œå®ä¾‹åŒ–

#### ç»“æ„ä½“

```rust
// ä¸€ä¸ªå­˜å‚¨ç”¨æˆ·è´¦å·ä¿¡æ¯çš„ç»“æ„ä½“
struct User {
  active: bool,
  username: String,
  email: String,
  sign_in_count: u64,
}
```

åˆ›å»ºä¸€ä¸ªå®ä¾‹éœ€è¦ä»¥ç»“æ„ä½“çš„åå­—å¼€å¤´ï¼Œæ¥ç€åœ¨å¤§æ‹¬å·ä¸­ä½¿ç”¨ `key: value` é”® - å€¼å¯¹çš„å½¢å¼æä¾›å­—æ®µ

```rust
// let mut user1 = User { ... } // å¯å˜çš„ User å®ä¾‹ã€‚Rust å¹¶ä¸å…è®¸åªå°†æŸä¸ªå­—æ®µæ ‡è®°ä¸ºå¯å˜
let user1 = User {
  active: true,
  username: String::from("someusername123"),
  email: String::from("someone@example.com"),
  sign_in_count: 1,
};
```

```rust
// æ”¹å˜ä¸€ä¸ªå¯å˜çš„ User å®ä¾‹ä¸­ email å­—æ®µçš„å€¼
let mut user1 = User {
  active: true,
  username: String::from("someusername123"),
  email: String::from("someone@example.com"),
  sign_in_count: 1,
};

user1.email = String::from("anotheremail@example.com");
```

**ä½¿ç”¨å­—æ®µåˆå§‹åŒ–ç®€å†™è¯­æ³•**

å‚æ•°åä¸å­—æ®µåå®Œå…¨ç›¸åŒçš„å‚æ•°å¯ä»¥ç®€å†™

```rust
fn build_user(email: String, username: String) -> User {
  User {
    active: true,
    username,
    email,
    sign_in_count: 1,
  }
}
```

**ä½¿ç”¨ç»“æ„ä½“æ›´æ–°è¯­æ³•ä»å…¶ä»–å®ä¾‹åˆ›å»ºå®ä¾‹**

```rust
let user2 = User {
  email: String::from("new@example.com"),
	..user1
};
```

`..` è¯­æ³•æŒ‡å®šäº†å‰©ä½™æœªæ˜¾å¼è®¾ç½®å€¼çš„å­—æ®µåº”æœ‰ä¸ç»™å®šå®ä¾‹å¯¹åº”å­—æ®µç›¸åŒçš„å€¼ã€‚

ç»“æ„ä½“æ›´æ–°è¯­æ³•**ç§»åŠ¨**äº†æ•°æ®ã€‚å¦‚æœ`user2` åªä½¿ç”¨äº†`user1`ä¸­å®ç° `Copy` trait çš„å€¼ï¼Œåˆ™`user1`å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚å¦åˆ™`user1`ä¸­çš„å€¼ç§»åŠ¨åˆ°`user2`å†…ï¼Œ`user1`å°†ä¸å†å¯ç”¨ã€‚

#### å…ƒç»„ç»“æ„ä½“

```rust
struct Color(i32, i32, i32);
struct Point(i32, i32, i32);

fn main() {
  let black = Color(0, 0, 0);
  let origin = Point(0, 0, 0);
}
```

`black` å’Œ `origin` å€¼çš„ç±»å‹ä¸åŒï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä¸åŒçš„å…ƒç»„ç»“æ„ä½“çš„å®ä¾‹ã€‚

#### æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç±»å•å…ƒç»“æ„ä½“

> ç±»å•å…ƒç»“æ„ä½“å¸¸å¸¸åœ¨ä½ æƒ³è¦åœ¨æŸä¸ªç±»å‹ä¸Šå®ç° trait ä½†ä¸éœ€è¦åœ¨ç±»å‹ä¸­å­˜å‚¨æ•°æ®çš„æ—¶å€™å‘æŒ¥ä½œç”¨ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬åç« ä»‹ç» traitã€‚

### è°ƒè¯•

`println!`å¯ä»¥é»˜è®¤è¾“å‡ºå®ç°äº† `Display`çš„ç±»å‹ï¼Œä½†ç»“æ„ä½“æ²¡æœ‰ã€‚ä¸ºäº†è¾“å‡ºç»“æ„ä½“ï¼Œè¿›è¡Œå¦‚ä¸‹è¾“å…¥

```rust
// Rust åŒ…å«äº†æ‰“å°å‡ºè°ƒè¯•ä¿¡æ¯çš„åŠŸèƒ½ï¼Œä¸è¿‡å¿…é¡»ä¸ºç»“æ„ä½“æ˜¾å¼é€‰æ‹©è¿™ä¸ªåŠŸèƒ½
// åœ¨ç»“æ„ä½“å®šä¹‰ä¹‹å‰åŠ ä¸Šå¤–éƒ¨å±æ€§ #[derive(Debug)]
#[derive(Debug)]
struct Rectangle {
  width: u32,
  height: u32,
}

fn main() {
  let rect1 = Rectangle {
    width: 30,
    height: 50,
  };

  println!("rect1 is {rect1:?}");
}
```

æœ‰å¦‚ä¸‹è¾“å‡º

```shell
rect1 is Rectangle { width: 30, height: 50 }
```

å¯ä»¥ä½¿ç”¨ `{:#?}` æ›¿æ¢ `println!` å­—ç¬¦ä¸²ä¸­çš„ `{:?}`

æœ‰å¦‚ä¸‹è¾“å‡º

```rust
rect1 is Rectangle {
    width: 30,
    height: 50,
}
```

å¯ä»¥çœ‹åˆ°å¯è¯»æ€§æ›´å¥½

å¦ä¸€ç§ä½¿ç”¨ `Debug` æ ¼å¼æ‰“å°æ•°å€¼çš„æ–¹æ³•æ˜¯ä½¿ç”¨ `dbg!` å®ã€‚

`dbg!` å®æ¥æ”¶ä¸€ä¸ªè¡¨è¾¾å¼çš„æ‰€æœ‰æƒï¼ˆ`println!` å®æ¥æ”¶çš„æ˜¯å¼•ç”¨ï¼‰

æ‰“å°å‡ºä»£ç ä¸­è°ƒç”¨ dbg! å®æ—¶æ‰€åœ¨çš„æ–‡ä»¶å’Œè¡Œå·ï¼Œä»¥åŠè¯¥è¡¨è¾¾å¼çš„ç»“æœå€¼ï¼Œå¹¶è¿”å›è¯¥å€¼çš„æ‰€æœ‰æƒã€‚

```rust
#[derive(Debug)]
struct Rectangle {
  width: u32,
  height: u32,
}

fn main() {
  let scale = 2;
  let rect1 = Rectangle {
    width: dbg!(30 * scale),
    height: 50,
  };

  dbg!(&rect1);
}
```

è¾“å‡ºå¦‚ä¸‹

```shell
[src/main.rs:10:16] 30 * scale = 60
[src/main.rs:14:5] &rect1 = Rectangle {
    width: 60,
    height: 50,
}
```

### æ–¹æ³•è¯­æ³•

#### æ–¹æ³•

**æ–¹æ³•**ï¼ˆmethodï¼‰ä¸å‡½æ•°ç±»ä¼¼ï¼Œä¸è¿‡å®ƒä»¬ç¬¬ä¸€ä¸ªå‚æ•°æ€»æ˜¯ `self`ï¼Œå®ƒä»£è¡¨è°ƒç”¨è¯¥æ–¹æ³•çš„ç»“æ„ä½“å®ä¾‹ã€‚

```rust
#[derive(Debug)]
struct Rectangle {
  width: u32,
  height: u32,
}

impl Rectangle {
  fn area(&self) -> u32 {
    self.width * self.height
  }
  fn print(&self) {
    println!("-----------------")
  }
}

fn main() {
  let rect1 = Rectangle {
    width: 30,
    height: 50,
  };

  println!(
    "The area of the rectangle is {} square pixels.",
    rect1.area()
  );
}
```

`&self`ä¸è·å–æ‰€æœ‰æƒ

`self`è·å–æ‰€æœ‰æƒ

`&mut self` å¯æ”¹å˜è°ƒç”¨æ–¹æ³•çš„å®ä¾‹ã€‚éœ€è¦å®ä¾‹ä½¿ç”¨`mut`å¯å˜å£°æ˜

```rust
struct Rectangle {
  width: u32,
  height: u32,
}

impl Rectangle {
  // å½“åœ¨ rect1.width åé¢åŠ ä¸Šæ‹¬å·æ—¶ã€‚Rust çŸ¥é“æŒ‡çš„æ˜¯æ–¹æ³• widthã€‚å½“ä¸ä½¿ç”¨åœ†æ‹¬å·æ—¶ï¼ŒRust çŸ¥é“æŒ‡çš„æ˜¯å­—æ®µ width
  fn width(&self) -> bool {
    self.width > 0
  }
}

fn main() {
  let rect1 = Rectangle {
    width: 30,
    height: 50,
  };

  if rect1.width() {
    println!(
      "The rectangle has a nonzero width; it is {}; it is å¤§äº 0 å—? {}",
      rect1.width,
      rect1.width()
    );
  }
}
```

> **è‡ªåŠ¨å¼•ç”¨å’Œè§£å¼•ç”¨**
>
> å¦‚æœ `rect2` æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œåœ¨ C/C++ è¯­è¨€ä¸­éœ€è¦ä½¿ç”¨ `->`è¿ç®—ç¬¦è°ƒç”¨æ–¹æ³•`rect2->width()`
>
> Rust å¹¶æ²¡æœ‰ä¸€ä¸ªä¸ `->` ç­‰æ•ˆçš„è¿ç®—ç¬¦ï¼›ç›¸åï¼ŒRust æœ‰ä¸€ä¸ªå« **è‡ªåŠ¨å¼•ç”¨å’Œè§£å¼•ç”¨**ï¼ˆ_automatic referencing and dereferencing_ï¼‰çš„åŠŸèƒ½ã€‚
>
> å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„ï¼šå½“ä½¿ç”¨ `rect2.width()` è°ƒç”¨æ–¹æ³•æ—¶ï¼ŒRust ä¼šè‡ªåŠ¨ä¸º `rect2` æ·»åŠ  `&`ã€`&mut` æˆ– `*` ä»¥ä¾¿ä½¿ `rect2` ä¸æ–¹æ³•ç­¾ååŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›ä»£ç æ˜¯ç­‰ä»·çš„ï¼š
>
> ```rust
> rect2.width();
> (&rect2).width();
> ```

#### å…³è”å‡½æ•°

æ‰€æœ‰åœ¨ `impl` å—ä¸­å®šä¹‰çš„å‡½æ•°è¢«ç§°ä¸º **å…³è”å‡½æ•°**ï¼ˆ_associated functions_ï¼‰ï¼Œå› ä¸ºå®ƒä»¬ä¸ `impl` åé¢å‘½åçš„ç±»å‹ç›¸å…³ã€‚

å¯ä»¥å®šä¹‰ä¸ä»¥ `self` ä¸ºç¬¬ä¸€å‚æ•°çš„å…³è”å‡½æ•°ï¼ˆå› æ­¤ä¸æ˜¯æ–¹æ³•ï¼‰ï¼Œå®ƒä»¬å¹¶ä¸ä½œç”¨äºä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹ï¼ˆç±»ä¼¼é™æ€æ–¹æ³•ï¼‰ã€‚

```rust
impl Rectangle {
  fn square(size: u32) -> Self {
    Self {
      width: size,
      height: size,
    }
  }
}
```

å…³é”®å­— `Self` åœ¨å‡½æ•°çš„è¿”å›ç±»å‹ä¸­ä»£æŒ‡åœ¨ `impl` å…³é”®å­—åå‡ºç°çš„ç±»å‹ï¼Œåœ¨è¿™é‡Œæ˜¯ `Rectangle`

ä½¿ç”¨ç»“æ„ä½“åå’Œ `::` è¯­æ³•æ¥è°ƒç”¨è¿™ä¸ªå…³è”å‡½æ•°ã€‚`::` è¯­æ³•ç”¨äºå…³è”å‡½æ•°å’Œæ¨¡å—åˆ›å»ºçš„å‘½åç©ºé—´ã€‚ç¬¬ä¸ƒç« ä¼šè®²åˆ°æ¨¡å—ã€‚

```rust
// åˆ›å»ºä¸€ä¸ªè¾¹é•¿3çš„æ­£æ–¹å½¢
let sq = Rectangle::square(3);
```

#### å¤šä¸ª `impl` å—

æ¯ä¸ªç»“æ„ä½“éƒ½å…è®¸æ‹¥æœ‰å¤šä¸ª `impl` å—

```rust
impl Rectangle {
  fn area(&self) -> u32 {
    self.width * self.height
  }
}

impl Rectangle {
  fn can_hold(&self, other: &Rectangle) -> bool {
    self.width > other.width && self.height > other.height
  }
}
```

ç¬¬åç« è®¨è®ºæ³›å‹å’Œ trait æ—¶ä¼šçœ‹åˆ°å®ç”¨çš„å¤š `impl` å—çš„ç”¨ä¾‹ã€‚

## æšä¸¾å’Œæ¨¡å¼åŒ¹é…

### æšä¸¾çš„å®šä¹‰

å®šä¹‰ä¸€ä¸ª `IpAddrKind` æšä¸¾æ¥è¡¨ç°è¿™ä¸ªæ¦‚å¿µå¹¶åˆ—å‡ºå¯èƒ½çš„ IP åœ°å€ç±»å‹ï¼š`V4` å’Œ `V6`ã€‚

```rust
enum IpAddrKind {
  V4,
  V6,
}
```

åˆ›å»º `IpAddrKind` ä¸¤ä¸ªä¸åŒæˆå‘˜çš„å®ä¾‹

```rust
let four = IpAddrKind::V4;
let six = IpAddrKind::V6;
```

å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è·å–ä»»ä½• `IpAddrKind`

```rust
fn route(ip_kind: IpAddrKind) {}

route(IpAddrKind::V4);
route(IpAddrKind::V6);
```

ä½¿ç”¨æšä¸¾å¹¶å°†æ•°æ®ç›´æ¥æ”¾è¿›æ¯ä¸€ä¸ªæšä¸¾æˆå‘˜

```rust
  enum IpAddr {
    V4(String),
    V6(String),
  }
  let home = IpAddr::V4(String::from("127.0.0.1"));
  let loopback = IpAddr::V6(String::from("::1"));
```

æšä¸¾çš„æ¯ä¸ªæˆå‘˜å¯ä»¥å¤„ç†ä¸åŒç±»å‹å’Œæ•°é‡çš„æ•°æ®

```rust
  enum IpAddr {
    V4(u8, u8, u8, u8),
    V6(String),
  }
  let home = IpAddr::V4(127, 0, 0, 1);
  let loopback = IpAddr::V6(String::from("::1"));
```

```rust
enum Message {
  Quit,
  Move { x: i32, y: i32 },
  Write(String),
  ChangeColor(i32, i32, i32),
}
```

è¿™ä¸ªæšä¸¾æœ‰å››ä¸ªå«æœ‰ä¸åŒç±»å‹çš„æˆå‘˜ï¼š

- `Quit` æ²¡æœ‰å…³è”ä»»ä½•æ•°æ®ã€‚
- `Move` ç±»ä¼¼ç»“æ„ä½“åŒ…å«å‘½åå­—æ®µã€‚
- `Write` åŒ…å«å•ç‹¬ä¸€ä¸ª `String`ã€‚
- `ChangeColor` åŒ…å«ä¸‰ä¸ª `i32`ã€‚

#### æ–¹æ³•è¯­æ³•

å¯ä»¥ä½¿ç”¨ `impl` åœ¨æšä¸¾ä¸Šå®šä¹‰æ–¹æ³•

```rust
  impl Message {
    fn call(&self) {
      // åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•ä½“
    }
  }

  let m = Message::Write(String::from("hello"));
  m.call();
```

#### `Option` æšä¸¾å’Œå…¶ç›¸å¯¹äºç©ºå€¼çš„ä¼˜åŠ¿

ï¼ŒRust å¹¶æ²¡æœ‰ç©ºå€¼ï¼Œä¸è¿‡å®ƒç¡®å®æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥ç¼–ç å­˜åœ¨æˆ–ä¸å­˜åœ¨æ¦‚å¿µçš„æšä¸¾ã€‚è¿™ä¸ªæšä¸¾æ˜¯ `Option<T>`ï¼Œè€Œä¸”å®ƒ[å®šä¹‰äºæ ‡å‡†åº“ä¸­](https://doc.rust-lang.org/std/option/enum.Option.html)

```rust
enum Option<T> {
  None,
  Some(T),
}
```

`Option<T>` æšä¸¾æ˜¯å¦‚æ­¤æœ‰ç”¨ä»¥è‡³äºå®ƒç”šè‡³è¢«åŒ…å«åœ¨äº† prelude ä¹‹ä¸­ï¼Œä½ ä¸éœ€è¦å°†å…¶æ˜¾å¼å¼•å…¥ä½œç”¨åŸŸã€‚

å®ƒçš„æˆå‘˜ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¯ä»¥ä¸éœ€è¦ `Option::` å‰ç¼€æ¥ç›´æ¥ä½¿ç”¨ `Some` å’Œ `None`

`<T>` è¯­æ³•æ˜¯ä¸€ä¸ªè¿˜æœªè®²åˆ°çš„ Rust åŠŸèƒ½ã€‚å®ƒæ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹å‚æ•°ï¼Œç¬¬åç« ä¼šæ›´è¯¦ç»†çš„è®²è§£æ³›å‹ã€‚

`Option<T>` ä¸ `T`çš„ç±»å‹ä¸åŒã€‚ä¸èƒ½æŠŠ`Option<i8>`å½“ä½œ`i8`ä½¿ç”¨ï¼Œå› ä¸º`Option<T>`å¯èƒ½ä¸º`None`

åœ¨å¯¹ `Option<T>` è¿›è¡Œè¿ç®—ä¹‹å‰å¿…é¡»å°†å…¶è½¬æ¢ä¸º `T`

### `match` æ§åˆ¶æµç»“æ„

> `switch`

```rust
enum Coin {
  Penny,
  Nickel,
  Dime,
  Quarter,
}
// è¿”å›ç¡¬å¸å¯¹åº”çš„é¢å€¼
fn value_in_cents(coin: Coin) -> u8 {
  match coin {
    Coin::Penny => {
      println!("Lucky penny!");
      1
    }
    Coin::Nickel => 5,
    Coin::Dime => 10,
    Coin::Quarter => 25,
  }
}
```

```rust
#[derive(Debug)]
enum UsState {
  Alabama,
  Alaska,
  // --snip--
}

enum Coin {
  Penny,
  Nickel,
  Dime,
  Quarter(UsState),
}

fn value_in_cents(coin: Coin) -> u8 {
  match coin {
    Coin::Penny => 1,
    Coin::Nickel => 5,
    Coin::Dime => 10,
    Coin::Quarter(state) => {
      println!("State quarter from {state:?}!");
      25
    }
  }
}
// state ç»‘å®šçš„å°†ä¼šæ˜¯å€¼ UsState::Alaska
value_in_cents(Coin::Quarter(UsState::Alaska));
```

#### åŒ¹é… `Option`

Rust ä¸­çš„åŒ¹é…æ˜¯ **ç©·å°½çš„**ï¼ˆ_exhaustive_ï¼‰ï¼šå¿…é¡»ç©·ä¸¾åˆ°æœ€åçš„å¯èƒ½æ€§æ¥ä½¿ä»£ç æœ‰æ•ˆã€‚

```rust
  fn plus_one(x: Option<i32>) -> Option<i32> {
    match x {
      // æ²¡æœ‰å¤„ç† None çš„æƒ…å†µï¼Œæ‰€ä»¥è¿™äº›ä»£ç ä¼šé€ æˆä¸€ä¸ª bugã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ª Rust çŸ¥é“å¦‚ä½•å¤„ç†çš„ bugã€‚å¦‚æœå°è¯•ç¼–è¯‘è¿™æ®µä»£ç ï¼Œä¼šå¾—åˆ°é”™è¯¯
      // None => None,
      Some(i) => Some(i + 1),
    }
  }

```

#### é…æ¨¡å¼å’Œ `_` å ä½ç¬¦

```rust
let dice_roll = 9;
match dice_roll {
  3 => add_fancy_hat(),
  7 => remove_fancy_hat(),
  // å¯ä»¥æ˜¯ä»»ä½•åç§° any => move_player(any)
  other => move_player(other),
}

fn add_fancy_hat() {}
fn remove_fancy_hat() {}
fn move_player(num_spaces: u8) {}
```

å³ä½¿æ²¡æœ‰åˆ—å‡º `u8` æ‰€æœ‰å¯èƒ½çš„å€¼ï¼Œè¿™æ®µä»£ç ä¾ç„¶èƒ½å¤Ÿç¼–è¯‘ï¼Œå› ä¸ºæœ€åä¸€ä¸ªæ¨¡å¼å°†åŒ¹é…æ‰€æœ‰æœªè¢«ç‰¹æ®Šåˆ—å‡ºçš„å€¼ã€‚

Rust è¿˜æä¾›äº†ä¸€ä¸ªæ¨¡å¼ï¼Œå½“æˆ‘ä»¬ä¸æƒ³ä½¿ç”¨é€šé…æ¨¡å¼è·å–çš„å€¼æ—¶ï¼Œè¯·ä½¿ç”¨ `_` ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ¨¡å¼ï¼Œå¯ä»¥åŒ¹é…ä»»æ„å€¼è€Œä¸ç»‘å®šåˆ°è¯¥å€¼ã€‚è¿™å‘Šè¯‰ Rust æˆ‘ä»¬ä¸ä¼šä½¿ç”¨è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥ Rust ä¹Ÿä¸ä¼šè­¦å‘Šæˆ‘ä»¬å­˜åœ¨æœªä½¿ç”¨çš„å˜é‡ã€‚

```rust
  let dice_roll = 9;
  match dice_roll {
    3 => add_fancy_hat(),
    7 => remove_fancy_hat(),
    _ => reroll(),
  }

  fn add_fancy_hat() {}
  fn remove_fancy_hat() {}
  fn reroll() {}
```

### `if let` ç®€æ´æ§åˆ¶æµ

```rust
let config_max = Some(3u8);
match config_max {
  Some(max) => println!("The maximum is configured to be {max}"),
  _ => (),
}
```

ä½¿ç”¨`match`æ—¶ï¼Œå³ä½¿åªå…³å¿ƒ`u8`ç±»å‹çš„å€¼ï¼Œä¹Ÿéœ€è¦åœ¨æœ€ååŠ ä¸Š`_ => ()`ã€‚

ä½¿ç”¨`if let`å¯ä»¥ç®€åŒ–ä»£ç 

```rust
let config_max = Some(3u8);
if let Some(max) = config_max {
	println!("The maximum is configgured to be {max}");
}
```

> <warn>?<warn/>
>
> ```rust
> let config_max = Some(Some(Some(Some(Some(Some(String::from("string")))))));
> if let Some(max) = config_max {
> dbg!(max);
> }
> ```
>
> > ä¸è¿‡è¿™æ˜¯å¯è¡Œçš„
> >
> > ```shell
> > Compiling test_code v0.1.0 (F:\Users\Documents\MyDocument\study\rust\code\test_code)
> >  Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.34s
> >   Running `target\debug\test_code.exe`
> > [src/main.rs:5:5] max = Some(
> >  Some(
> >      Some(
> >          Some(
> >              Some(
> >                  "string",
> >              ),
> >          ),
> >      ),
> >  ),
> > )
> > ```

å¯ä»¥åœ¨ `if let` ä¸­åŒ…å«ä¸€ä¸ª `else`ã€‚`else` å—ä¸­çš„ä»£ç ä¸ `match` è¡¨è¾¾å¼ä¸­çš„ `_` åˆ†æ”¯å—ä¸­çš„ä»£ç ç›¸åŒ

ä¸‹é¢ä¸¤ä¸ªä»£ç å—å«ä¹‰ç›¸åŒ

```rust
  let mut count = 0;
  match coin {
    Coin::Quarter(state) => println!("State quarter from {state:?}!"),
    _ => count += 1,
  }
```

```rust
  let mut count = 0;
  if let Coin::Quarter(state) = coin {
    println!("State quarter from {state:?}!");
  } else {
    count += 1;
  }
```

## ä½¿ç”¨åŒ…ã€Crate å’Œæ¨¡å—ç®¡ç†ä¸æ–­å¢é•¿çš„é¡¹ç›®

> - **åŒ…**ï¼ˆ_Packages_ï¼‰ï¼šCargo çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ æ„å»ºã€æµ‹è¯•å’Œåˆ†äº« crateã€‚
> - **Crates** ï¼šä¸€ä¸ªæ¨¡å—çš„æ ‘å½¢ç»“æ„ï¼Œå®ƒå½¢æˆäº†åº“æˆ–äºŒè¿›åˆ¶é¡¹ç›®ã€‚
> - **æ¨¡å—**ï¼ˆ_Modules_ï¼‰å’Œ **use**ï¼šå…è®¸ä½ æ§åˆ¶ä½œç”¨åŸŸå’Œè·¯å¾„çš„ç§æœ‰æ€§ã€‚
> - **è·¯å¾„**ï¼ˆ_path_ï¼‰ï¼šä¸€ä¸ªå‘½åä¾‹å¦‚ç»“æ„ä½“ã€å‡½æ•°æˆ–æ¨¡å—ç­‰é¡¹çš„æ–¹å¼ã€‚

### åŒ…å’Œ Crate

**crate**

ç”¨ `rustc` è€Œä¸æ˜¯ `cargo` æ¥ç¼–è¯‘ä¸€ä¸ªæ–‡ä»¶ï¼Œç¼–è¯‘å™¨è¿˜æ˜¯ä¼šå°†é‚£ä¸ªæ–‡ä»¶è®¤ä½œä¸€ä¸ª `crate`ã€‚

`crate` æœ‰ä¸¤ç§å½¢å¼ï¼šäºŒè¿›åˆ¶é¡¹å’Œåº“ã€‚

_äºŒè¿›åˆ¶é¡¹_ å¯ä»¥è¢«ç¼–è¯‘ä¸ºå¯æ‰§è¡Œç¨‹åºï¼Œæ¯”å¦‚ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºæˆ–è€…ä¸€ä¸ª `web server`ã€‚å®ƒä»¬å¿…é¡»æœ‰ä¸€ä¸ª `main` å‡½æ•°æ¥å®šä¹‰å½“ç¨‹åºè¢«æ‰§è¡Œçš„æ—¶å€™æ‰€éœ€è¦åšçš„äº‹æƒ…ã€‚

_åº“_ å¹¶æ²¡æœ‰ `main` å‡½æ•°ï¼Œå®ƒä»¬ä¹Ÿä¸ä¼šç¼–è¯‘ä¸ºå¯æ‰§è¡Œç¨‹åºï¼Œå®ƒä»¬æä¾›ä¸€äº›è¯¸å¦‚å‡½æ•°ä¹‹ç±»çš„ä¸œè¥¿ï¼Œä½¿å…¶ä»–é¡¹ç›®ä¹Ÿèƒ½ä½¿ç”¨è¿™äº›ä¸œè¥¿ã€‚

`crate root` æ˜¯ä¸€ä¸ªæºæ–‡ä»¶ï¼Œ`Rust `ç¼–è¯‘å™¨ä»¥å®ƒä¸ºèµ·å§‹ç‚¹ï¼Œå¹¶æ„æˆä½ çš„ crate` çš„æ ¹æ¨¡å—ã€‚

**åŒ…**

_åŒ…_ï¼ˆ`package`ï¼‰æ˜¯æä¾›ä¸€ç³»åˆ—åŠŸèƒ½çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ª `crate`ã€‚ä¸€ä¸ªåŒ…ä¼šåŒ…å«ä¸€ä¸ª `Cargo.toml` æ–‡ä»¶ï¼Œé˜è¿°å¦‚ä½•å»æ„å»ºè¿™äº› `crate`ã€‚

`Cargo` å°±æ˜¯ä¸€ä¸ªåŒ…å«æ„å»ºä½ ä»£ç çš„äºŒè¿›åˆ¶é¡¹çš„åŒ…ã€‚`Cargo` ä¹ŸåŒ…å«è¿™äº›äºŒè¿›åˆ¶é¡¹æ‰€ä¾èµ–çš„åº“ã€‚å…¶ä»–é¡¹ç›®ä¹Ÿèƒ½ç”¨ `Cargo` åº“æ¥å®ç°ä¸ Cargo` å‘½ä»¤è¡Œç¨‹åºä¸€æ ·çš„é€»è¾‘ã€‚

åŒ…ä¸­å¯ä»¥åŒ…å«è‡³å¤šä¸€ä¸ªåº“ `crate(library crate)`ã€‚åŒ…ä¸­å¯ä»¥åŒ…å«ä»»æ„å¤šä¸ªäºŒè¿›åˆ¶ `crate(binary crate)`ï¼Œä½†æ˜¯å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ª` crate`ï¼ˆæ— è®ºæ˜¯åº“çš„è¿˜æ˜¯äºŒè¿›åˆ¶çš„ï¼‰ã€‚

`Cargo`è®¤ä¸º`src/main.rs` å°±æ˜¯ä¸€ä¸ªä¸åŒ…åŒåçš„äºŒè¿›åˆ¶ `crate` çš„ `crate` æ ¹ã€‚

å¦‚æœä¸€ä¸ªåŒ…åŒæ—¶å«æœ‰ `src/main.rs` å’Œ `src/lib.rs`ï¼Œåˆ™å®ƒæœ‰ä¸¤ä¸ª `crate`ï¼šä¸€ä¸ªäºŒè¿›åˆ¶çš„å’Œä¸€ä¸ªåº“çš„ï¼Œä¸”åå­—éƒ½ä¸åŒ…ç›¸åŒã€‚

`Cargo` çŸ¥é“å¦‚æœåŒ…ç›®å½•ä¸­åŒ…å« `src/lib.rs`ï¼Œåˆ™åŒ…å¸¦æœ‰ä¸å…¶åŒåçš„åº“ `crate`ï¼Œä¸” `src/lib.rs` æ˜¯ `crate` æ ¹ã€‚

### å®šä¹‰æ¨¡å—æ¥æ§åˆ¶ä½œç”¨åŸŸä¸ç§æœ‰æ€§

#### æ¨¡å—

**å£°æ˜æ¨¡å—**

å†…è”

```rust
mod first_test {
  pub fn print_what() {
    println!("what");
  }
}

fn main() {
  first_test::print_what();
}
```

åœ¨æ–‡ä»¶ `src/garden.rs`æˆ– `src/garden/mod.rs`

`src\main.rs`

```rust
mod garden;
```

**å£°æ˜å­æ¨¡å—**

åœ¨*src/garden.rs*ä¸­å®šä¹‰äº†`mod vegetables;`

å†…è”

ç›´æ¥å®šä¹‰åœ¨`src/garden/mod.rs`ä¸­

```rust
mod vegetables {
  pub struct Asparagus {}
}
```

åœ¨æ–‡ä»¶ `src/garden/vegetables.rs`æˆ– `src/garden/vegetables/mod.rs`

```rust
mod vegetables;
```

`vegetables.rs`

```rust
pub struct Asparagus {}
```

**æ¨¡å—ä¸­çš„ä»£ç è·¯å¾„**

ä¸€æ—¦ä¸€ä¸ªæ¨¡å—æ˜¯ä½  crate çš„ä¸€éƒ¨åˆ†ï¼Œä½ å¯ä»¥åœ¨éšç§è§„åˆ™å…è®¸çš„å‰æä¸‹ï¼Œä»åŒä¸€ä¸ª crate å†…çš„ä»»æ„åœ°æ–¹ï¼Œé€šè¿‡ä»£ç è·¯å¾„å¼•ç”¨è¯¥æ¨¡å—çš„ä»£ç ã€‚

ä¾‹å¦‚ï¼Œä¸€ä¸ª garden vegetables æ¨¡å—ä¸‹çš„`Asparagus`ç±»å‹å¯ä»¥åœ¨`crate::garden::vegetables::Asparagus`è¢«æ‰¾åˆ°ã€‚

**ç§æœ‰ vs å…¬ç”¨**

ä¸€ä¸ªæ¨¡å—é‡Œçš„ä»£ç é»˜è®¤å¯¹å…¶çˆ¶æ¨¡å—ç§æœ‰ã€‚

ä¸ºäº†ä½¿ä¸€ä¸ªæ¨¡å—å…¬ç”¨ï¼Œåº”å½“åœ¨å£°æ˜æ—¶ä½¿ç”¨`pub mod`æ›¿ä»£`mod`ã€‚ä¸ºäº†ä½¿ä¸€ä¸ªå…¬ç”¨æ¨¡å—å†…éƒ¨çš„æˆå‘˜å…¬ç”¨ï¼Œåº”å½“åœ¨å£°æ˜å‰ä½¿ç”¨`pub`ã€‚

**`use` å…³é”®å­—**

åœ¨ä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œ`use`å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªæˆå‘˜çš„å¿«æ·æ–¹å¼ï¼Œç”¨æ¥å‡å°‘é•¿è·¯å¾„çš„é‡å¤

```rust
use crate::garden::vegetables::Asparagus;
mod garden;
fn main() {
  let plant = Asparagus {};
  println!("I'm growing {:?}, length: {:?}", plant, plant.length);
}
```

ç­‰åŒäº

```rust
mod garden;
fn main() {
  let plant = crate::garden::vegetables::Asparagus {};
  println!("I'm growing {:?}, length: {:?}", plant, plant.length);
}
```

#### åœ¨æ¨¡å—ä¸­å¯¹ç›¸å…³ä»£ç è¿›è¡Œåˆ†ç»„

æ‰§è¡Œ `cargo new --lib restaurant`ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„åä¸º `restaurant` çš„åº“ï¼Œå®šä¹‰ä¸€äº›æ¨¡å—å’Œå‡½æ•°ã€‚

`src/lib.rs`

```rust
mod front_of_house {
  mod hosting {
    fn add_to_waitlist() {}

    fn seat_at_table() {}
  }

  mod serving {
    fn take_order() {}

    fn serve_order() {}

    fn take_payment() {}
  }
}
```

### å¼•ç”¨æ¨¡å—é¡¹ç›®çš„è·¯å¾„

- **ç»å¯¹è·¯å¾„**ï¼ˆ_absolute path_ï¼‰æ˜¯ä»¥ crate æ ¹ï¼ˆrootï¼‰å¼€å¤´çš„å…¨è·¯å¾„ï¼›å¯¹äºå¤–éƒ¨ crate çš„ä»£ç ï¼Œæ˜¯ä»¥ crate åå¼€å¤´çš„ç»å¯¹è·¯å¾„ï¼Œå¯¹äºå½“å‰ crate çš„ä»£ç ï¼Œåˆ™ä»¥å­—é¢å€¼ `crate` å¼€å¤´ã€‚

- **ç›¸å¯¹è·¯å¾„**ï¼ˆ_relative path_ï¼‰ä»å½“å‰æ¨¡å—å¼€å§‹ï¼Œä»¥ `self`ã€`super` æˆ–å®šä¹‰åœ¨å½“å‰æ¨¡å—ä¸­çš„æ ‡è¯†ç¬¦å¼€å¤´ã€‚

```rust
mod front_of_house {
  pub mod hosting {
    pub fn add_to_waitlist() {}
  }
}

pub fn eat_at_restaurant() {
  // ç»å¯¹è·¯å¾„
  crate::front_of_house::hosting::add_to_waitlist();

  // ç›¸å¯¹è·¯å¾„
  front_of_house::hosting::add_to_waitlist();
}
```

#### ä½¿ç”¨`pub`å…³é”®å­—æš´éœ²è·¯å¾„

çˆ¶æ¨¡å—ä¸­çš„é¡¹ä¸èƒ½ä½¿ç”¨å­æ¨¡å—ä¸­çš„ç§æœ‰é¡¹ï¼Œä½†æ˜¯å­æ¨¡å—ä¸­çš„é¡¹å¯ä»¥ä½¿ç”¨å®ƒä»¬çˆ¶æ¨¡å—ä¸­çš„ç§æœ‰é¡¹ã€‚

`lib.rs`

```rust
use garden::vegetables::add_a;
mod garden;

fn add(x: u32, y: u32) -> u32 {
  x + y
}

fn main() {
  add_a();
}
```

`garden\mod.rs`

```rust
pub mod vegetables;
```

`garden\vegetables\mod.rs`

```rust
use crate::add;

pub fn add_a() {
  println!("in vegetables add_a: {}", add(2, 1));
}
```

#### `super`å¼€å§‹çš„ç›¸å¯¹è·¯å¾„

å¯ä»¥é€šè¿‡åœ¨è·¯å¾„çš„å¼€å¤´ä½¿ç”¨ `super` ï¼Œä»çˆ¶æ¨¡å—å¼€å§‹æ„å»ºç›¸å¯¹è·¯å¾„ï¼Œè€Œä¸æ˜¯ä»å½“å‰æ¨¡å—æˆ–è€… crate æ ¹å¼€å§‹ã€‚

è¿™ç±»ä¼¼ä»¥ `..` è¯­æ³•å¼€å§‹ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚

```rust
fn deliver_order() {}

mod back_of_house {
  fn fix_incorrect_order() {
    cook_order();
    super::deliver_order();
  }

  fn cook_order() {}
}
```

#### `self`å¼€å§‹çš„ç›¸å¯¹è·¯å¾„

ä»å½“å‰æ¨¡å—å¼€å§‹æ„å»ºç›¸å¯¹è·¯å¾„ã€‚

å¯ä»¥çœç•¥ã€‚

#### åˆ›å»ºå…¬æœ‰çš„ç»“æ„ä½“å’Œæšä¸¾

å¦‚æœåœ¨ä¸€ä¸ªç»“æ„ä½“å®šä¹‰çš„å‰é¢ä½¿ç”¨äº† `pub` ï¼Œè¿™ä¸ªç»“æ„ä½“ä¼šå˜æˆå…¬æœ‰çš„ï¼Œä½†æ˜¯è¿™ä¸ªç»“æ„ä½“çš„å­—æ®µä»ç„¶æ˜¯ç§æœ‰çš„ã€‚

å¯¹äºç§æœ‰å­—æ®µï¼Œå¯ä»¥é€šè¿‡åŒä¸€ç»“æ„ä½“ä¸Šçš„å…¬æœ‰æ–¹æ³•è®¿é—®ã€‚

å¯¹äºæ‹¥æœ‰ç§æœ‰å­—æ®µçš„ç»“æ„ä½“ï¼Œéœ€è¦æä¾›ä¸€ä¸ªå…¬å…±çš„å…³è”å‡½æ•°æ¥æ„é€ å®ä¾‹ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½åœ¨å¤–éƒ¨è®¾ç½®ç§æœ‰å­—æ®µçš„å€¼ã€‚

```rust
mod back_of_house {
  pub struct Breakfast {
    pub toast: String,
    seasonal_fruit: String,
  }

  impl Breakfast {
    pub fn summer(toast: &str) -> Breakfast {
      Breakfast {
        toast: String::from(toast),
        seasonal_fruit: String::from("peaches"),
      }
    }
  }
}

pub fn eat_at_restaurant() {
  // åœ¨å¤å¤©è®¢è´­ä¸€ä¸ªé»‘éº¦åœŸå¸ä½œä¸ºæ—©é¤
  let mut meal = back_of_house::Breakfast::summer("Rye");
  // æ”¹å˜ä¸»æ„æ›´æ¢æƒ³è¦é¢åŒ…çš„ç±»å‹
  meal.toast = String::from("Wheat");
  println!("I'd like {} toast please", meal.toast);

  // å¦‚æœå–æ¶ˆä¸‹ä¸€è¡Œçš„æ³¨é‡Šä»£ç ä¸èƒ½ç¼–è¯‘ï¼›
  // ä¸å…è®¸æŸ¥çœ‹æˆ–ä¿®æ”¹æ—©é¤é™„å¸¦çš„å­£èŠ‚æ°´æœ
  // meal.seasonal_fruit = String::from("blueberries");
}
```

### ä½¿ç”¨ `use` å…³é”®å­—å°†è·¯å¾„å¼•å…¥ä½œç”¨åŸŸ

`use`åªèƒ½åˆ›å»º `use` æ‰€åœ¨çš„ç‰¹å®šä½œç”¨åŸŸå†…çš„çŸ­è·¯å¾„

```rust
use garden::vegetables::add_a;
use garden::vegetables::Asparagus;

mod garden;

fn add(x: u32, y: u32) -> u32 {
  x + y
}

fn main() {
  let plant = Asparagus::create(3);
  println!("I'm growing {:?}, length: {:?}", plant, plant.get_length());
  add_a();
}

mod twice {
  // å’Œä¸Šé¢çš„useä¸åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸï¼Œéœ€è¦å†æ¬¡åˆ›å»º
  use crate::garden::vegetables::add_a;

  fn t() {
    add_a()
  }
}
```

#### åˆ›å»ºæƒ¯ç”¨çš„`use`è·¯å¾„

**å¯¹äºå‡½æ•°**

å°†å‡½æ•°å¼•å…¥ä½œç”¨åŸŸçš„ä¹ æƒ¯ç”¨æ³•æ˜¯å°†å…¶çˆ¶ä½œç”¨åŸŸå¼•å…¥ï¼Œé€šè¿‡çˆ¶ä½œç”¨åŸŸè°ƒç”¨å‡½æ•°ã€‚

è¿™æ ·å¯ä»¥æ¸…æ™°åœ°è¡¨æ˜å‡½æ•°ä¸æ˜¯åœ¨æœ¬åœ°å®šä¹‰çš„

```rust
use crate::garden::vegetables;

fn t() {
  vegetables::add_a()
}
```

**å¯¹äºç»“æ„ä½“ã€æšä¸¾å’Œå…¶ä»–é¡¹**

ä¹ æƒ¯æ˜¯æŒ‡å®šå®ƒä»¬çš„å®Œæ•´è·¯å¾„ã€‚

```rust
use garden::vegetables::Asparagus;
fn main() {
  let plant = Asparagus::create(3);
  println!("I'm growing {:?}, length: {:?}", plant, plant.get_length());
}
```

ä½†å¦‚æœä¸åŒä½œç”¨åŸŸæœ‰ç›¸åŒå‘½åçš„ç»“æ„ä½“æˆ–å…¶ä»–é¡¹ï¼Œä½¿ç”¨çˆ¶æ¨¡å—å¯ä»¥åŒºåˆ†è¿™äº›ç±»å‹ã€‚

#### ä½¿ç”¨`as`å…³é”®å­—æä¾›æ–°çš„åç§°

```rust
use std::fmt::Result;
use std::io::Result as IoResult;

fn function1() -> Result {
  // --snip--
}

fn function2() -> IoResult<()> {
  // --snip--
}
```

#### ä½¿ç”¨`pub use`é‡å¯¼å‡ºåç§°

å‡è®¾å‡½æ•°`add_to_waitlist`éœ€è¦è·¯å¾„ `restaurant::front_of_house::hosting::add_to_waitlist` æ¥è°ƒç”¨ã€‚

ä½¿ç”¨`pub use` ä»æ ¹æ¨¡å—é‡å¯¼å‡ºäº† `hosting` æ¨¡å—åï¼Œå¯ä»¥ä½¿ç”¨è·¯å¾„`restaurant::hosting::add_to_waitlist`æ¥è°ƒç”¨ã€‚

#### ä½¿ç”¨å¤–éƒ¨åŒ…

ä¸ºäº†åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ `rand`ï¼Œåœ¨ _Cargo.toml_ ä¸­åŠ å…¥äº†å¦‚ä¸‹è¡Œï¼š

æ–‡ä»¶åï¼šCargo.toml

```toml
rand = "0.8.5"
```

```rust
// ä¸è®ºåœ¨å“ªä¸ªä½œç”¨åŸŸéƒ½æ˜¯å¦‚æ­¤
use rand::Rng;

fn main() {
  let secret_number = rand::thread_rng().gen_range(1..=100);
}
```

> <tip/>
>
> è¿™é‡Œä½¿ç”¨çš„è¿™ç±»èŒƒå›´è¡¨è¾¾å¼ä½¿ç”¨äº† `start..=end` è¿™æ ·çš„å½¢å¼ï¼Œä¹Ÿå°±æ˜¯è¯´åŒ…å«äº†ä¸Šä¸‹ç«¯ç‚¹ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®š `1..=100` æ¥è¯·æ±‚ä¸€ä¸ª 1 å’Œ 100 ä¹‹é—´çš„æ•°ã€‚

[crates.io](https://crates.io/) ä¸Šæœ‰å¾ˆå¤š Rust ç¤¾åŒºæˆå‘˜å‘å¸ƒçš„åŒ…ï¼Œå°†å…¶å¼•å…¥ä½ è‡ªå·±çš„é¡¹ç›®éƒ½éœ€è¦ä¸€é“ç›¸åŒçš„æ­¥éª¤ï¼šåœ¨ _Cargo.toml_ åˆ—å‡ºå®ƒä»¬å¹¶é€šè¿‡ `use` å°†å…¶ä¸­å®šä¹‰çš„é¡¹å¼•å…¥é¡¹ç›®åŒ…çš„ä½œç”¨åŸŸä¸­ã€‚

> <tip/>
>
> æ ‡å‡†åº“éš Rust è¯­è¨€ä¸€åŒåˆ†å‘ï¼Œæ— éœ€ä¿®æ”¹ _Cargo.toml_ æ¥å¼•å…¥æ ‡å‡†åº“ï¼Œå¦‚ `std`

#### åµŒå¥—è·¯å¾„æ¥æ¶ˆé™¤å¤§é‡çš„`use`è¡Œ

```rust
use garden::{vegetables, vegetables::Asparagus};
// use garden::vegetables::{self, Asparagus}; // ä¹Ÿå¯ä»¥
use std::io::{self, Write};
```

ç­‰åŒäº

```rust
use garden::vegetables;
use garden::vegetables::Asparagus;

use std::io;
use std::io::Write;
```

#### é€šè¿‡`glob`è¿ç®—ç¬¦å°†æ‰€æœ‰çš„å…¬æœ‰å®šä¹‰å¼•å…¥ä½œç”¨åŸŸ

å¦‚æœå¸Œæœ›å°†ä¸€ä¸ªè·¯å¾„ä¸‹ **æ‰€æœ‰** å…¬æœ‰é¡¹å¼•å…¥ä½œç”¨åŸŸï¼Œå¯ä»¥æŒ‡å®šè·¯å¾„åè·Ÿ `*`ï¼Œglob è¿ç®—ç¬¦

```rust
use std::collections::*;
```

> <warn/>
>
> ä½¿ç”¨ glob è¿ç®—ç¬¦æ—¶è¯·å¤šåŠ å°å¿ƒï¼Glob ä¼šä½¿å¾—æˆ‘ä»¬éš¾ä»¥æ¨å¯¼ä½œç”¨åŸŸä¸­æœ‰ä»€ä¹ˆåç§°å’Œå®ƒä»¬æ˜¯åœ¨ä½•å¤„å®šä¹‰çš„ã€‚

### å°†æ¨¡å—æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶

æ³¨æ„ä½ åªéœ€åœ¨æ¨¡å—æ ‘ä¸­çš„æŸå¤„ä½¿ç”¨ä¸€æ¬¡ `mod` å£°æ˜å°±å¯ä»¥åŠ è½½è¿™ä¸ªæ–‡ä»¶ï¼Œè€Œä¸éœ€è¦åœ¨æ¯ä¸ªç”¨åˆ°è¯¥æ¨¡å—çš„éƒ½ä½¿ç”¨`mod`å£°æ˜ã€‚

`mod` **ä¸æ˜¯** ä½ å¯èƒ½ä¼šåœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­çœ‹åˆ°çš„ "include" æ“ä½œ

ä¸€æ—¦ç¼–è¯‘å™¨çŸ¥é“äº†è¿™ä¸ªæ–‡ä»¶æ˜¯é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼ˆå¹¶ä¸”é€šè¿‡ `mod` è¯­å¥çš„ä½ç½®çŸ¥é“äº†ä»£ç åœ¨æ¨¡å—æ ‘ä¸­çš„ä½ç½®ï¼‰ï¼Œé¡¹ç›®ä¸­çš„å…¶ä»–æ–‡ä»¶ç›´æ¥ä½¿ç”¨æ¨¡å—å£°æ˜çš„ä½ç½®çš„è·¯å¾„å³å¯å¼•ç”¨è¿™ä¸ªæ–‡ä»¶çš„ä»£ç ã€‚

## å¸¸è§é›†åˆ

**é›†åˆ**ï¼ˆ_collections_ï¼‰

ä¸åŒäºå†…å»ºçš„æ•°ç»„å’Œå…ƒç»„ç±»å‹ï¼Œè¿™äº›é›†åˆæŒ‡å‘çš„æ•°æ®æ˜¯å‚¨å­˜åœ¨å †ä¸Šçš„ï¼Œæ•°æ®çš„æ•°é‡ä¸å¿…åœ¨ç¼–è¯‘æ—¶å°±å·²çŸ¥ï¼Œå¯ä»¥éšç€ç¨‹åºçš„è¿è¡Œå¢é•¿æˆ–ç¼©å°ã€‚

- `vector`å…è®¸æˆ‘ä»¬ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªåœ°å‚¨å­˜ä¸€ç³»åˆ—æ•°é‡å¯å˜çš„å€¼
- **å­—ç¬¦ä¸²**ï¼ˆ_string_ï¼‰æ˜¯å­—ç¬¦çš„é›†åˆ
- **å“ˆå¸Œ map**ï¼ˆ_hash map_ï¼‰å…è®¸æˆ‘ä»¬å°†å€¼ä¸ä¸€ä¸ªç‰¹å®šçš„é”®ï¼ˆkeyï¼‰ç›¸å…³è”ã€‚è¿™æ˜¯ä¸€ä¸ªå«åš _map_ çš„æ›´é€šç”¨çš„æ•°æ®ç»“æ„çš„ç‰¹å®šå®ç°

> å¯¹äºæ ‡å‡†åº“æä¾›çš„å…¶ä»–ç±»å‹çš„é›†åˆï¼Œè¯·æŸ¥çœ‹[æ–‡æ¡£](https://doc.rust-lang.org/std/collections/index.html)ã€‚

### ä½¿ç”¨`vector`å‚¨å­˜åˆ—è¡¨

`Vec<T>`ï¼Œä¹Ÿè¢«ç§°ä¸º _vector_ã€‚

#### æ–°å»º`vector`

```rust
let v: Vec<i32> = Vec::new();
```

Rust æä¾›äº† `vec!` å®ï¼Œè¿™ä¸ªå®ä¼šæ ¹æ®æˆ‘ä»¬æä¾›çš„å€¼æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ vectorã€‚

```rust
// æä¾›äº† i32 ç±»å‹çš„åˆå§‹å€¼ï¼ŒRust å¯ä»¥æ¨æ–­å‡º v çš„ç±»å‹æ˜¯ Vec<i32>ï¼Œå› æ­¤ç±»å‹æ³¨è§£å°±ä¸æ˜¯å¿…é¡»çš„ã€‚
let v = vec![1, 2, 3];
```

#### æ›´æ–°`vector`

```rust
let mut v = Vec::new();
// Rustä¼šè®¤ç¬¬ä¸€ä¸ªåŠ å…¥çš„æ•°æ®ç±»å‹ä¸ºvecçš„å­˜å‚¨ç±»å‹
v.push(5);
v.push(6);
v.push(7);
v.push(8);
```

#### è¯»å–`vector`

```rust
let v = vec![1, 2, 3, 4, 5];
// ç´¢å¼•è¯­æ³•
let third: &i32 = &v[2]; // 3
// getè¯­æ³•
let third: Option<&i32> = v.get(2); // Option(3)
```

å½“ä½¿ç”¨ç´¢å¼•è¯­æ³•ï¼Œè¾“å…¥ä¸€ä¸ªèŒƒå›´ä¹‹å¤–çš„ç´¢å¼•å€¼ä¼šé€ æˆ panicã€‚

ä½¿ç”¨getè¯­æ³•ï¼Œåˆ™ä¸ä¼šé€ æˆ panicï¼Œè€Œæ˜¯è¿”å› `None`ã€‚

#### éå†`vector`ä¸­çš„å…ƒç´ 

```rust
let v = vec![100, 32, 57];
for i in &v {
  println!("{i}");
}
```

```rust
let mut v = vec![100, 32, 57];
for i in &mut v {
  // i æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œéœ€è¦è§£å¼•ç”¨ä»¥è®¿é—®æ­£ç¡®çš„åœ°å€
  *i += 50;
}
```

#### ä½¿ç”¨æšä¸¾æ¥å‚¨å­˜å¤šç§ç±»å‹

vector åªèƒ½å‚¨å­˜ç›¸åŒç±»å‹çš„å€¼ã€‚è¿™æ˜¯å¾ˆä¸æ–¹ä¾¿çš„ã€‚

å¹¸è¿çš„æ˜¯ï¼Œæšä¸¾çš„æˆå‘˜éƒ½è¢«å®šä¹‰ä¸ºç›¸åŒçš„æšä¸¾ç±»å‹ï¼Œæ‰€ä»¥å½“éœ€è¦åœ¨ vector ä¸­å‚¨å­˜ä¸åŒç±»å‹å€¼æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¹¶ä½¿ç”¨ä¸€ä¸ªæšä¸¾ï¼

```rust
  enum SpreadsheetCell {
    Int(i32),
    Float(f64),
    Text(String),
  }

  let row = vec![
    SpreadsheetCell::Int(3),
    SpreadsheetCell::Text(String::from("blue")),
    SpreadsheetCell::Float(10.12),
  ];
```

> <tip/>
>
> ç°åœ¨æˆ‘ä»¬äº†è§£äº†ä¸€äº›ä½¿ç”¨ vector çš„æœ€å¸¸è§çš„æ–¹å¼ï¼Œè¯·ä¸€å®šå»çœ‹çœ‹æ ‡å‡†åº“ä¸­ `Vec` å®šä¹‰çš„å¾ˆå¤šå…¶ä»–å®ç”¨æ–¹æ³•çš„ [API æ–‡æ¡£](https://doc.rust-lang.org/std/vec/struct.Vec.html)ã€‚ä¾‹å¦‚ï¼Œé™¤äº† `push` ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ª `pop` æ–¹æ³•ï¼Œå®ƒä¼šç§»é™¤å¹¶è¿”å› vector çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚

#### ä¸¢å¼ƒ`vector`æ—¶ä¹Ÿä¼šä¸¢å¼ƒå…¶æ‰€æœ‰å…ƒç´ 

ç±»ä¼¼äºä»»ä½•å…¶ä»–çš„ `struct`ï¼Œvector åœ¨å…¶ç¦»å¼€ä½œç”¨åŸŸæ—¶ä¼šè¢«é‡Šæ”¾

å½“ vector è¢«ä¸¢å¼ƒæ—¶ï¼Œæ‰€æœ‰å…¶å†…å®¹ä¹Ÿä¼šè¢«ä¸¢å¼ƒ
